<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Consistency checker | immudb</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="The lightweight, high-speed immutable database for systems and applications.">
    <link rel="preload" href="/assets/css/0.styles.77cf719a.css" as="style"><link rel="preload" href="/assets/js/app.f8f7c295.js" as="script"><link rel="preload" href="/assets/js/2.d1e427b0.js" as="script"><link rel="preload" href="/assets/js/3.45e2a264.js" as="script"><link rel="preload" href="/assets/js/12.cf4462a2.js" as="script"><link rel="prefetch" href="/assets/js/10.79bdbfdb.js"><link rel="prefetch" href="/assets/js/11.536ef737.js"><link rel="prefetch" href="/assets/js/13.6269b52d.js"><link rel="prefetch" href="/assets/js/14.5c62b501.js"><link rel="prefetch" href="/assets/js/15.28288ea6.js"><link rel="prefetch" href="/assets/js/16.4199cf57.js"><link rel="prefetch" href="/assets/js/4.287878a1.js"><link rel="prefetch" href="/assets/js/5.25a54ae0.js"><link rel="prefetch" href="/assets/js/6.8b2dc024.js"><link rel="prefetch" href="/assets/js/7.c2138538.js"><link rel="prefetch" href="/assets/js/8.2c21299e.js"><link rel="prefetch" href="/assets/js/9.706b7c0a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77cf719a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="immudb" class="logo"> <span class="site-name can-hide">
            immudb
        </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.immudb.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
    Website
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/codenotary/immudb" target="_blank" rel="noopener noreferrer" class="nav-link external">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.immudb.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
    Website
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/codenotary/immudb" target="_blank" rel="noopener noreferrer" class="nav-link external">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Get started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/introduction.html" class="sidebar-link">Introduction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>immudb</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/immudb/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/docs/immudb/consistency-checker.html" aria-current="page" class="active sidebar-link">Consistency checker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/immudb/consistency-checker.html#how-you-run-it" class="sidebar-link">How you run it?</a></li><li class="sidebar-sub-header"><a href="/docs/immudb/consistency-checker.html#what-does-it-check" class="sidebar-link">What does it check?</a></li><li class="sidebar-sub-header"><a href="/docs/immudb/consistency-checker.html#how-does-it-run-its-check" class="sidebar-link">How does it run its check?</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>immugw</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/immugw/introduction.html" class="sidebar-link">Introduction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>immuadmin</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/immuadmin/introduction.html" class="sidebar-link">Introduction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>immuclient</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/immuclient/introduction.html" class="sidebar-link">Introduction</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="consistency-checker"><a href="#consistency-checker" class="header-anchor">#</a> Consistency checker</h1> <h2 id="how-you-run-it"><a href="#how-you-run-it" class="header-anchor">#</a> How you run it?</h2> <p>It’s built as part of immudb and is enabled by default. It runs as a thread within immudb.
It's possible disable the routine with following options:</p> <div class="language- extra-class"><pre class="language-text"><code>./immudb --consistency-check=false
</code></pre></div><h2 id="what-does-it-check"><a href="#what-does-it-check" class="header-anchor">#</a> What does it check?</h2> <p>Consistency checker runs a loop in which it continuously checks if the elements stored inside immudb merkle tree are physically stored correctly on the disk (the digest of the disk element's is the same digest stored in the related merkle tree leaf)</p> <h2 id="how-does-it-run-its-check"><a href="#how-does-it-run-its-check" class="header-anchor">#</a> How does it run its check?</h2> <h3 id="steps"><a href="#steps" class="header-anchor">#</a> Steps:</h3> <ul><li>It starts taking last root and last index stored in immudb.</li> <li>It generates a range between 0 and the length of the merkle tree level 0(total number of elements stored)</li> <li>In order to be unpredictable it shuffles the range to get a random scan list</li> <li>It start to checks if every element is correctly inserted in the tree and if the merkle tree leaves correctly represents the elements stored on hard disk.</li> <li>When it completes the loop it sleep ten seconds and restart from the beginning with a new root and index.</li> <li>When it found an element that doesn’t pass correctly the corruption check it immediately stop immudb with a log a message.</li></ul> <p>In order to reproduce a corruption and modify an entry only on disk and not in merkle tree stop immudb and use <a href="https://github.com/codenotary/immudb/blob/master/tools/nimmu/nimmu.go" target="_blank" rel="noopener noreferrer">nimmu<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>go build tools/nimmu/nimmu.go 
./nimmu rawset key1 tamper
</code></pre></div><p>At the end restart immudb and should see the consistency check error.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
            ←
            <a href="/docs/immudb/introduction.html" class="prev">
                Introduction
            </a></span> <span class="next"><a href="/docs/immugw/introduction.html">
                Introduction
            </a>
            →
        </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f8f7c295.js" defer></script><script src="/assets/js/2.d1e427b0.js" defer></script><script src="/assets/js/3.45e2a264.js" defer></script><script src="/assets/js/12.cf4462a2.js" defer></script>
  </body>
</html>
